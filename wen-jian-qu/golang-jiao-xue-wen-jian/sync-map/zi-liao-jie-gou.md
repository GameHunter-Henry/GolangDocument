# ğŸ“ƒ è³‡æ–™çµæ§‹

åœ¨è¬›è§£sync.mapçš„è³‡æ–™çµæ§‹å‰ï¼Œå…ˆä¾†èŠèŠåœ¨sync.mapé‚„æœªå‡ºä¾†å‰ï¼Œå®˜æ–¹æ˜¯æ€éº¼æä¾›è§£æ±ºæ–¹å¼çš„å§

#### äº’æ–¥é–

```go
var MyMap = struct {
    sync.Mutex
    m map[string]int
}
```

å°±æ˜¯å¦‚æ­¤æš´åŠ›ç°¡å–®ï¼Œå‰µå»ºä¸€å€‹structç„¶å¾Œè³‡æ–™æˆå“¡å°±æ˜¯äº’æ–¥é–è·Ÿmapã€‚

#### ä»¥åŠä½¿ç”¨è®€å¯«é–çš„æ–¹å¼ï¼š

```go
var MyRwMap struct {
    sync.RWMutex
    m map[int]int
}
```

ä½†é€™å…©ç¨®æ–¹å¼åœ¨ä½µç™¼çš„åŒæ™‚æœƒç™¼ç”Ÿæ¶é–çš„äº‹æƒ…ï¼Œæ–¼æ˜¯goå®˜æ–¹åœ¨1.9çš„æ™‚å€™ç™¼å¸ƒäº†æ–°çš„sync.mapï¼š

```go
type Map struct {
    mu Mutex
    read atomic.Value //readOnly
    dirty map[interface{}] *entry
    misses int
}
```

* muï¼šäº’æ–¥é–ï¼Œç”¨æ–¼ä¿è­· read å’Œ dirtyã€‚
* readï¼šåªè®€æ•¸æ“šï¼Œæ”¯æŒä½µç™¼è®€å–ï¼ˆatomic.Value é¡å‹ï¼‰ã€‚å¦‚æœæ¶‰åŠåˆ°æ›´æ–°æ“ä½œï¼Œå‰‡åªéœ€è¦åŠ é–ä¾†ä¿è­‰æ•¸æ“šå®‰å…¨ã€‚
* read å¯¦éš›å­˜å„²çš„æ˜¯ readOnly çµæ§‹é«”ï¼Œå…§éƒ¨ä¹Ÿæ˜¯ä¸€å€‹åŸç”Ÿ mapï¼Œamended å±¬æ€§ç”¨æ–¼æ¨™è¨˜ read å’Œ dirty çš„æ•¸æ“šæ˜¯å¦ä¸€è‡´ã€‚
* dirtyï¼šè®€å¯«æ•¸æ“šï¼Œæ˜¯ä¸€å€‹åŸç”Ÿ mapï¼Œä¹Ÿå°±æ˜¯éç·šç¨‹å®‰å…¨ã€‚æ“ä½œ dirty éœ€è¦åŠ é–ä¾†ä¿è­‰æ•¸æ“šå®‰å…¨ã€‚
* missesï¼šçµ±è¨ˆæœ‰å¤šå°‘æ¬¡è®€å– read æ²’æœ‰å‘½ä¸­ã€‚æ¯æ¬¡ read ä¸­è®€å–å¤±æ•—å¾Œï¼Œmisses çš„è¨ˆæ•¸å€¼éƒ½æœƒåŠ  1ã€‚
